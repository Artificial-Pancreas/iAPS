var freeaps_autosens;(()=>{var e={83:(e,t)=>{"use strict";t.maxDailyBasal=function(e){var t=e.basals.length?e.basals.reduce(((e,t)=>Number(t.rate)>Number(e.rate)?t:e)):null;return 1e3*Number(t.rate)/1e3},t.maxBasalLookup=function(e){return e.settings.maxBasal},t.basalLookup=function(e,t){var a=t;void 0===t&&(a=new Date);var r=e.slice().sort(((e,t)=>e.i-t.i)),i=r[r.length-1].rate;if(0!==i){for(var s=60*a.getHours()+a.getMinutes(),n=0;n<r.length-1;n++)if(s>=r[n].minutes&&s<r[n+1].minutes){i=r[n].rate;break}return Math.round(1e3*i)/1e3}console.error("ERROR: bad basal schedule",e)}},103:e=>{"use strict";e.exports=function(e,t){if(0===e.length)return 0;if("number"!=typeof t)throw new TypeError("p must be a number");if(t<=0)return e[0];if(t>=1)return e[e.length-1];var a=e.length*t,r=Math.floor(a),i=r+1,s=a%1;return i>=e.length?e[r]:e[r]*(1-s)+e[i]*s}},191:(e,t,a)=>{"use strict";var r=a(466),i=a(635),s=a(663),n=a(249);e.exports=function(e,t,a){if(a)o=[];else{a=i(e);var o=i(e,240)}var u={treatments:a,profile:e.profile,calculate:s};e.autosens&&(u.autosens=e.autosens);var d={treatments:o,profile:e.profile,calculate:s},l=[];/(Z|[+-][0-2][0-9]:?[034][05])+/.test(e.clock)||console.error("Warning: clock input "+e.clock+" is unzoned; please pass clock-zoned.json instead");var p,m=r(e.clock),c=new Date(0).getTime(),f={};f.date=new Date(0).getTime(),a.forEach((function(e){e.insulin&&e.started_at?c=Math.max(c,e.started_at):"number"==typeof e.rate&&e.duration&&e.date>f.date&&((f=e).duration=Math.round(100*f.duration)/100)})),p=t?1:240;for(var v=0;v<p;v+=5){var g=new Date(m.getTime()+6e4*v),h=n(u,g),b=n(d,g);l.push(h),l[l.length-1].iobWithZeroTemp=b}return l[0].lastBolusTime=c,l[0].lastTemp=f,l}},249:(e,t)=>{"use strict";e.exports=function(e,t){var a,r=t.getTime(),i=e.calculate,s=e.treatments,n=e.profile,o=n.dia,u=0,d=0,l=0,p=0,m=0,c=0;if(!s)return{};o<3&&(o=3);var f={bilinear:{requireLongDia:!1,peak:75},"rapid-acting":{requireLongDia:!0,peak:75,tdMin:300},"ultra-rapid":{requireLongDia:!0,peak:55,tdMin:300}},v="bilinear";void 0!==n.curve&&(v=n.curve.toLowerCase()),v in f||(console.error('Unsupported curve function: "'+v+'". Supported curves: "bilinear", "rapid-acting" (Novolog, Novorapid, Humalog, Apidra) and "ultra-rapid" (Fiasp). Defaulting to "rapid-acting".'),v="rapid-acting");var g=f[v];return g.requireLongDia&&o<5&&(o=5),a=g.peak,s.forEach((function(e){if(e.date<=r){var s=r-60*o*60*1e3;if(e.date>s){var f=i(e,t,v,o,a,n);f&&f.iobContrib&&(u+=f.iobContrib),f&&f.activityContrib&&(c+=f.activityContrib),e.insulin&&f&&f.iobContrib&&(e.insulin<.1?(d+=f.iobContrib,p+=e.insulin):(l+=f.iobContrib,m+=e.insulin))}}})),{iob:Math.round(1e3*u)/1e3,activity:Math.round(1e4*c)/1e4,basaliob:Math.round(1e3*d)/1e3,bolusiob:Math.round(1e3*l)/1e3,netbasalinsulin:Math.round(1e3*p)/1e3,bolusinsulin:Math.round(1e3*m)/1e3,time:t}}},260:(e,t)=>{"use strict";function a(e,t,a){for(var r=0;r<e.length;r++){var i=e[r];if(i.timestamp===t&&void 0!==i[a])return!0;if(void 0!==i[a]){var s=new Date(i.timestamp),n=new Date(t),o=new Date(n.getTime()-2e3),u=new Date(n.getTime()+2e3);if(s>o&&s<u)return!0}}return!1}e.exports=function(e){for(var t=e.history,r=e.carbs,i=(e.profile,[]),s=[],n=0;n<r.length;n++){var o=r[n];if(o.carbs&&o.created_at){var u={};u.timestamp=o.created_at,u.carbs=o.carbs,u.nsCarbs=o.carbs,a(i,o.created_at,"carbs")?1:i.push(u)}}for(n=0;n<t.length;n++)"Bolus"===(o=t[n])._type&&o.timestamp?((u={}).timestamp=o.timestamp,u.bolus=o.amount,a(i,o.timestamp,"bolus")?1:i.push(u)):"BolusWizard"===o._type&&o.timestamp?s.push(o):"Meal Bolus"!==o._type&&"Correction Bolus"!==o._type&&"Snack Bolus"!==o._type&&"Bolus Wizard"!==o._type&&"Carb Correction"!==o._type||!o.created_at?"xdrip"===o.enteredBy?((u={}).timestamp=o.created_at,u.carbs=o.carbs,u.nsCarbs=o.carbs,u.bolus=o.insulin,a(i,o.timestamp,"carbs")?1:i.push(u)):o.carbs>0?((u={}).carbs=o.carbs,u.nsCarbs=o.carbs,u.timestamp=o.created_at,u.bolus=o.insulin,a(i,o.timestamp,"carbs")?1:i.push(u)):"JournalEntryMealMarker"===o._type&&o.carb_input>0&&o.timestamp&&((u={}).timestamp=o.timestamp,u.carbs=o.carb_input,u.journalCarbs=o.carb_input,a(i,o.timestamp,"carbs")?1:i.push(u)):((u={}).timestamp=o.created_at,u.carbs=o.carbs,u.nsCarbs=o.carbs,a(i,o.created_at,"carbs")?1:i.push(u));for(n=0;n<s.length;n++)o=s[n],(u={}).timestamp=o.timestamp,u.carbs=o.carb_input,u.bwCarbs=o.carb_input,a(i,o.timestamp,"carbs")?1:a(i,o.timestamp,"bolus")?i.push(u):(console.error("Skipping bolus wizard entry",n,"in the pump history with",o.carb_input,"g carbs and no insulin."),0===o.carb_input&&console.error("This is caused by a BolusWizard without carbs. If you specified insulin, it will be noted as a seperate Bolus"),o.timestamp&&console.error("Timestamp of bolus wizard:",o.timestamp));return i}},466:(e,t)=>{e.exports=function(e){if(void 0===e)return new Date;if(null===e)throw new TypeError("Null date input");if(e instanceof Date)return new Date(e.getTime());if("number"==typeof e){const t=new Date(e);if(!t)throw new TypeError(`Invalid date input: ${e}`);return t}if("string"==typeof e){const t=Date.parse(e);if(isNaN(t))throw new TypeError(`Invalid date input (string): ${e}`);return new Date(t)}throw new TypeError("Unsupported date input: "+typeof e)}},497:(e,t)=>{"use strict";function a(e,t,a){var r=t;void 0===t&&(r=new Date);var i=60*r.getHours()+r.getMinutes();if(a&&i>=a.offset&&i<a.endOffset)return[a.sensitivity,a];var s=(e=e.sensitivities.slice().sort(((e,t)=>e.offset-t.offset)))[e.length-1];if(0!==e[0].offset)return[-1,a];for(var n=1440,o=0;o<e.length-1;o++){var u=e[o],d=e[o+1];if(i>=u.offset&&i<d.offset){n=d.offset,s=e[o];break}}return(a=s).endOffset=n,[s.sensitivity,a]}a.isfLookup=a,e.exports=a},500:(e,t,a)=>{"use strict";var r=a(83),i=a(191),s=a(635),n=a(497),o=a(260),u=a(466),d=a(103);function l(e,t){try{e.sort((function(e,t){return new Date(e.created_at)<new Date(t.created_at)}))}catch(e){}for(var a=0;a<e.length;a++){var r=new Date(e[a].created_at),i=new Date(r.getTime()+60*e[a].duration*1e3);if(t>=new Date(e[a].created_at)&&0===e[a].duration)return 0;if(t>=new Date(e[a].created_at)&&t<i)return(e[a].targetTop+e[a].targetBottom)/2}}e.exports=function(e){var t=e.glucose_data.map((function(e){return e.glucose=e.glucose||e.sgv,e})),a=e.iob_inputs,p=e.basalprofile,m=e.iob_inputs.profile;if(e.retrospective)var c=new Date(new Date(t[0].date).getTime()-864e5);else c=new Date((new Date).getTime()-864e5);if(!0===e.iob_inputs.profile.rewind_resets_autosens)for(var f=e.iob_inputs.history,v=1;v<f.length;++v)if(f[v]._type&&"Rewind"===f[v]._type&&f[v].timestamp){c=new Date(f[v].timestamp),console.error("Setting lastSiteChange to",c,"using timestamp",f[v].timestamp);break}var g=s(e.iob_inputs),h={history:e.iob_inputs.history,profile:m,carbs:e.carbs,glucose:e.glucose_data},b=o(h);b.sort((function(e,t){var a=u(e.timestamp);return u(t.timestamp).getTime()-a.getTime()}));var _=[],w=[],y=[],T=[];t.reverse(),T[0]=t[0];for(var D=0,M=1;M<t.length;++M){var k,x;if(t[M].display_time)k=new Date(t[M].display_time.replace("T"," "));else if(t[M].dateString)k=new Date(t[M].dateString);else{if(t[M].xDrip_started_at)continue;console.error("Could not determine BG time")}if(t[M-1].display_time)x=new Date(t[M-1].display_time.replace("T"," "));else if(t[M-1].dateString)x=new Date(t[M-1].dateString);else if(T[0].display_time)x=new Date(T[0].display_time.replace("T"," "));else{if(t[M-1].xDrip_started_at)continue;console.error("Could not determine last BG time")}if(!(t[M].glucose<39||t[M-1].glucose<39)){if(c)if((k-c)/36e5<0)continue;var B=(k-x)/6e4;Math.abs(B)>2?(T[++D]=t[M],T[D].date=k.getTime()):T[D].glucose=(T[D].glucose+t[M].glucose)/2}}for(T.shift(),M=b.length-1;M>0;--M){var C=b[M];if(C){var S=u(C.timestamp),P=S.getTime(),N=T[0];if(!N||!N.date)continue;var E=new Date(N.date),I=E.getTime();P<I&&b.splice(M,1)}}var z=0,L=0,F=0,A=0,H=999,R="",O=null;for(M=3;M<T.length;++M){var W,q,U,j;if(k=new Date(T[M].date),[W,O]=n.isfLookup(m.isfProfile,k,O),void 0!==T[M].glucose){q=T[M].glucose;var G=T[M-1].glucose,Z=T[M-3].glucose;if(isNaN(q)||!q||q<40||isNaN(Z)||!Z||Z<40||isNaN(G)||!G||G<40)process.stderr.write("!");else{j=q-G,U=(U=(q-Z)/3).toFixed(2),a.clock=k,a.profile.current_basal=r.basalLookup(p,k),a.profile.temptargetSet=!1;var $,J=i(a,!0,g)[0],K=Math.round(-J.activity*W*5*100)/100;if(K=K.toFixed(2),isNaN(j)?console.error("Bad delta: ",j,q,G,Z):$=j-K,q<80&&$>0&&($=0),$=$.toFixed(2),N=T[M],I=(E=new Date(N.date)).getTime(),(C=b[b.length-1])&&(P=(S=u(C.timestamp)).getTime())<I){if(C.carbs>=1){F+=parseFloat(C.carbs),A+=parseFloat(C.carbs);var Q=Math.round(F);process.stderr.write(Q.toString()+"g")}b.pop()}if(F>0){var V=Math.max($,m.min_5m_carbimpact),X=V*m.carb_ratio/W;X?F=Math.max(0,F-X):console.error(X,V,m.carb_ratio,W,$,m.min_5m_carbimpact)}if(F>0||z||A>0)z=$>0?1:0,H>60&&F<.5&&(Q=Math.round(F),process.stderr.write(Q.toString()+"g"),z=0),!z&&F<.5&&(A=0),"csf"!==R&&(process.stderr.write("("),H=0),H++,R="csf",N.mealCarbs=A;else{"csf"===R&&process.stderr.write(")");var Y=a.profile.current_basal;!e.retrospective&&J.iob>2*Y||L||H<9?(H++,L=$>0?1:0,"uam"!==R&&process.stderr.write("u("),R="uam"):("uam"===R&&process.stderr.write(")"),R="non-meal")}if("non-meal"===R?($>0?process.stderr.write("+"):0===$?process.stderr.write("="):process.stderr.write("-"),_.push(U),w.push(K),y.push($),parseFloat($)):process.stderr.write("x"),!0===m.high_temptarget_raises_sensitivity||!0===m.exercise_mode){var ee=l(e.temptargets,k);if(ee>100){var te=-(ee-100)/20;process.stderr.write("-"),y.push(te)}}var ae=k.getMinutes(),re=k.getHours();ae>=0&&ae<5&&(process.stderr.write(re.toString()+"h"),re%2==0&&(y.push(0),process.stderr.write("=")));var ie=e.deviations;ie||(ie=96),y.length>ie&&y.shift()}}else console.error("Could not find glucose data")}if(process.stderr.write(" "),console.error(""),console.error("Using most recent",y.length,"deviations since",c),y.length<96){var se=Math.round(18*(1-y.length/96));console.error("Adding",se,"more zero deviations");for(var ne=0;ne<se;ne++)y.push(0)}for(_.sort((function(e,t){return e-t})),w.sort((function(e,t){return e-t})),y.sort((function(e,t){return e-t})),M=.9;M>.1;M-=.01){if(d(y,M+.01)>=0&&d(y,M)<0){var oe=Math.round(100*M);console.error(oe+"% of non-meal deviations negative (>50% = sensitivity)")}if(d(y,M+.01)>0&&d(y,M)<=0){var ue=100-Math.round(100*M);console.error(ue+"% of non-meal deviations positive (>50% = resistance)")}}var de=d(y,.5),le=d(y,.5),pe=(y.length,y.reduce((function(e,t){var a=parseFloat(t);return e+a*a}),0)),me=Math.sqrt(pe/y.length);console.error("RMS deviation: "+me.toFixed(2));var ce=0;de<0?(ce=12*de/m.sens,process.stderr.write("Insulin sensitivity detected: ")):le>0?(ce=12*le/m.sens,process.stderr.write("Insulin resistance detected: ")):console.error("Sensitivity normal.");var fe=1+ce/m.max_daily_basal,ve=fe;fe=Math.max(fe,m.autosens_min),(fe=Math.min(fe,m.autosens_max))!==ve&&console.error("Ratio limited from "+ve+" to "+fe),fe=Math.round(100*fe)/100;var ge=Math.round(m.sens/fe);return console.error("ISF adjusted from "+m.sens+" to "+ge),{ratio:fe,newisf:ge}}},635:(e,t,a)=>{"use strict";var r=a(83),i=a(466);function s(e,t){var a=[e];if("recurring"===t.type){var r=60*e.started_at.getHours()+e.started_at.getMinutes(),s=r+e.duration;if(e.duration>30||r<t.minutes&&s>t.minutes||s>1440&&t.minutes<s-1440){var n=structuredClone(e),o=structuredClone(e),u=0;if(e.duration>30)u=30;else{var d=t.minutes;s>1440&&(d=1440),u=d-r}var l=new Date(i(e.started_at).getTime()+60*u*1e3);n.duration=u,o.duration=e.duration-u,o.timestamp=l.toISOString(),o.started_at=new Date(o.timestamp),o.date=o.started_at.getTime(),a=[n,o]}}return a}function n(e,t){for(var a=[e],r=!0;r;){var i=[];for(const e of a){r=!1;for(const a of t){const t=s(e,a);if(t.length>1){i.push(...t),r=!0;break}}r||i.push(e)}a=i}return a}e.exports=function(e,t){var a,s,o=e.history,u=(e.history24,e.profile),d=e.autosens,l=[],p=[],m=[],c=[],f=!1,v=!1,g=i(e.clock);if(e.history24)o=[].concat(e.history).concat(e.history24);for(var h=g,b=0;b<o.length;b++){var _={};"PumpSuspend"===(y=o[b])._type?(_.timestamp=y.timestamp,_.started_at=i(y.timestamp),_.date=_.started_at.getTime(),m.push(_)):"PumpResume"===y._type&&(_.timestamp=y.timestamp,_.started_at=i(y.timestamp),_.date=_.started_at.getTime(),c.push(_))}m.sort(((e,t)=>e.date-t.date)),c.sort(((e,t)=>e.date-t.date)),c.length>0&&(a=c[0].timestamp,(0===m.length||c[0].date<m[0].date)&&(f=!0));var w=0;for(b=0;b<m.length;b++){for(;w<c.length&&!(c[w].date>m[b].date);w++);if(w>=c.length&&!v){v=1,s=m[b].timestamp;break}m[b].duration=(c[w].date-m[b].date)/60/1e3}for(f||v||c.length===m.length?f&&!v&&c.length-1!==m.length?console.error("Mismatched number of resumes("+c.length+") and suspends("+m.length+") assuming suspended prior to history block!"):!f&&v&&c.length!==m.length-1?console.error("Mismatched number of resumes("+c.length+") and suspends("+m.length+") assuming suspended past end of history block!"):f&&v&&c.length!==m.length&&console.error("Mismatched number of resumes("+c.length+") and suspends("+m.length+") assuming suspended prior to and past end of history block!"):console.error("Mismatched number of resumes("+c.length+") and suspends("+m.length+")!"),b<m.length-1&&m.splice(b+1,m.length-b-1),b=0;b<o.length;b++){var y;if((y=o[b]).bolus&&"Bolus"===y.bolus._type)y=(_=y).bolus;y.created_at&&(y.timestamp=y.created_at);var T=i(y.timestamp);if(!(T>h))if(h=T,"Bolus"===y._type)(_={}).timestamp=y.timestamp,_.started_at=i(y.timestamp),_.started_at>g?process.stderr.write(" "+y.amount+"U @ "+_.started_at):(_.date=_.started_at.getTime(),_.insulin=y.amount,p.push(_));else if("Meal Bolus"===y.eventType||"Correction Bolus"===y.eventType||"Snack Bolus"===y.eventType||"Bolus Wizard"===y.eventType){(_={}).timestamp=y.created_at,_.started_at=i(_.timestamp),_.date=_.started_at.getTime(),_.insulin=y.insulin,p.push(_)}else if("xdrip"===y.enteredBy){(_={}).timestamp=y.timestamp,_.started_at=i(_.timestamp),_.date=_.started_at.getTime(),_.insulin=y.insulin,p.push(_)}else if("HAPP_App"===y.enteredBy&&y.insulin){(_={}).timestamp=y.created_at,_.started_at=i(_.timestamp),_.date=_.started_at.getTime(),_.insulin=y.insulin,p.push(_)}else if("Temp Basal"!==y.eventType||"HAPP_App"!==y.enteredBy&&"openaps://AndroidAPS"!==y.enteredBy){if("Temp Basal"===y.eventType){(_={}).rate=y.rate,_.duration=y.duration,void 0!==y.amount&&(_.rate=y.amount/y.duration*60),_.timestamp=y.timestamp,_.started_at=i(_.timestamp),_.date=_.started_at.getTime(),l.push(_)}else if("TempBasal"===y._type){if("percent"===y.temp)continue;var D,M=y.rate,k=y.timestamp;if(b>0&&o[b-1].timestamp===k&&"TempBasalDuration"===o[b-1]._type)D=o[b-1]["duration (min)"];else{for(var x=0;x<o.length;x++)if(o[x].timestamp===k&&"TempBasalDuration"===o[x]._type){D=o[x]["duration (min)"];break}void 0===D&&console.error("No duration found for "+M+" U/hr basal "+k,o[b-1],y,o[b+1])}(_={}).rate=M,_.timestamp=y.timestamp,_.started_at=i(_.timestamp),_.date=_.started_at.getTime(),_.duration=D,l.push(_)}}else{(_={}).rate=y.absolute,_.duration=y.duration,_.timestamp=y.created_at,_.started_at=i(_.timestamp),_.date=_.started_at.getTime(),l.push(_)}}for((_={rate:0}).started_at=new Date(g.getTime()+6e4),_.date=_.started_at.getTime(),_.duration=t||0,l.push(_),l.sort(((e,t)=>e.date-t.date)),b=0;b+1<l.length;b++)l[b].date+60*l[b].duration*1e3>l[b+1].date&&(l[b].duration=(l[b+1].date-l[b].date)/60/1e3,null===l[b+1].duration&&l.splice(b+1,1));var B=[];u.basalprofile.forEach((e=>{const t={type:"recurring",minutes:e.minutes};B.push(t)}));var C=[];l.forEach((e=>{C=C.concat(n(e,B))})),l.sort(((e,t)=>e.date-t.date));var S,P=!1;if(void 0!==u.suspend_zeros_iob&&(P=u.suspend_zeros_iob),P){var N=[];C.forEach((e=>{var t=function(e,t,a,r,s,n){var o=[],u=new Date(a).getTime(),d=new Date(s).getTime();if(r&&e.date<u&&(e.date+60*e.duration*1e3<u?e.duration=0:(e.duration=(e.date+60*e.duration*1e3-u)/60/1e3,e.started_at=i(a),e.date=u)),n&&d&&e.date+60*e.duration*1e3>d&&(e.date>d?e.duration=0:e.duration=(d-e.date)/60/1e3),o.push(e),0===e.duration)return o;for(var l=0;l<t.length;l++)for(var p=t[l],m=0;m<o.length;m++)if(o[m].date<=p.date&&o[m].date+60*o[m].duration*1e3>p.date){if(o[m].date+60*o[m].duration*1e3>p.date+60*p.duration*1e3){var c=structuredClone(o[m]),f=new Date(i(p.started_at).getTime()+60*p.duration*1e3);c.timestamp=f.toISOString(),c.started_at=i(c.timestamp),c.date=p.date+60*p.duration*1e3,c.duration=(o[m].date+60*o[m].duration*1e3-(p.date+60*p.duration*1e3))/60/1e3,o.push(c)}o[m].duration=(p.date-o[m].date)/60/1e3}else if(p.date<=o[m].date&&p.date+60*p.duration*1e3>o[m].date){o[m].duration=(o[m].date+60*o[m].duration*1e3-(p.date+60*p.duration*1e3))/60/1e3;var v=new Date(i(p.started_at).getTime()+60*p.duration*1e3);o[m].timestamp=v.toISOString(),o[m].started_at=i(o[m].timestamp),o[m].date=p.date+60*p.duration*1e3}return o}(e,m,a,f,s,v);N.push(...t)}));var E=[];m.forEach((e=>{void 0!==e.duration&&E.push({_type:"SuspendBasal",rate:0,duration:e.duration,date:e.date,started_at:e.started_at})}));var I=g.getTime()-288e5,z=new Date(a).getTime();if(f&&I<z){var L=[{_type:"SuspendBasal",rate:0,duration:(z-I)/60/1e3,date:A=(F=new Date(I)).getTime(),started_at:H=i(F)}];E=E.concat(L)}if(v){var F,A=(F=new Date(s)).getTime(),H=i(F);L=[{_type:"SuspendBasal",rate:0,duration:(g-A)/60/1e3,date:A,timestamp:s,started_at:H}];E=E.concat(L)}E.forEach((e=>{N=N.concat(n(e,B))}))}else N=C;for(N.sort(((e,t)=>e.date-t.date)),b=0;b<N.length;b++){var R=N[b];if(R.duration>0){var O,W,q=u.current_basal;u.basalprofile&&u.basalprofile.length>0&&(q=r.basalLookup(u.basalprofile,new Date(R.timestamp))),void 0!==u.min_bg&&void 0!==u.max_bg&&(O=(u.min_bg+u.max_bg)/2);var U=u;if(U.half_basal_exercise_target)var j=U.half_basal_exercise_target;else j=160;if(U.exercise_mode&&U.temptargetSet&&O>=105){var G=j-100;W=G/(G+O-100)}else void 0!==d&&(W=d.ratio);W&&(q*=W);var Z=R.rate-q;S=Z<0?-.05:.05;var $=Math.round(Z*R.duration*10/6)/100,J=Math.round($/S),K=R.duration/J;for(w=0;w<J;w++){var Q={};Q.insulin=S,Q.date=R.date+w*K*60*1e3,Q.created_at=new Date(Q.date),p.push(Q)}}}var V=[].concat(p).concat(l);return V.sort(((e,t)=>e.date-t.date)),V}},663:(e,t)=>{"use strict";e.exports=function(e,t,a,r,i,s){if(e.insulin){void 0===t&&(t=new Date);var n=new Date(e.date),o=Math.round((t-n)/1e3/60);return"bilinear"===a?function(e,t,a){var r=75,i=180,s=3/a,n=s*t,o=0,u=0,d=2/(60*a),l=d/r,p=d/(i-r)*-1;if(n<r){o=e.insulin*(l*n);var m=n/5+1;u=e.insulin*(-.001852*m*m+.001852*m+1)}else if(n<i){var c=n-r;o=e.insulin*(d+p*c);var f=(n-r)/5;u=e.insulin*(.001323*f*f+-.054233*f+.55556)}return{activityContrib:o,iobContrib:u}}(e,o,r):function(e,t,a,r,i){"rapid-acting"===i.curve?!0===i.useCustomPeakTime&&void 0!==i.insulinPeakTime?i.insulinPeakTime>120?(console.error("Setting maximum Insulin Peak Time of 120m for",i.curve,"insulin"),r=120):i.insulinPeakTime<50?(console.error("Setting minimum Insulin Peak Time of 50m for",i.curve,"insulin"),r=50):r=i.insulinPeakTime:r=75:"ultra-rapid"===i.curve?!0===i.useCustomPeakTime&&void 0!==i.insulinPeakTime?i.insulinPeakTime>100?(console.error("Setting maximum Insulin Peak Time of 100m for",i.curve,"insulin"),r=100):i.insulinPeakTime<35?(console.error("Setting minimum Insulin Peak Time of 35m for",i.curve,"insulin"),r=35):r=i.insulinPeakTime:r=55:console.error("Curve of",i.curve,"is not supported.");var s=60*a,n=0,o=0;if(t<s){var u=r*(1-r/s)/(1-2*r/s),d=2*u/s,l=1/(1-d+(1+d)*Math.exp(-s/u));n=e.insulin*(l/Math.pow(u,2))*t*(1-t/s)*Math.exp(-t/u),o=e.insulin*(1-l*(1-d)*((Math.pow(t,2)/(u*s*(1-d))-t/u-1)*Math.exp(-t/u)+1))}return{activityContrib:n,iobContrib:o}}(e,o,r,i,s)}return{}}}},t={};var a=function a(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,a),s.exports}(500);freeaps_autosens=a})();