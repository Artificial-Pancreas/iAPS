var freeaps_iob;(()=>{var e={83:(e,t)=>{"use strict";t.maxDailyBasal=function(e){var t=e.basals.length?e.basals.reduce(((e,t)=>Number(t.rate)>Number(e.rate)?t:e)):null;return 1e3*Number(t.rate)/1e3},t.maxBasalLookup=function(e){return e.settings.maxBasal},t.basalLookup=function(e,t){var a=t;void 0===t&&(a=new Date);var r=e.slice().sort(((e,t)=>e.i-t.i)),i=r[r.length-1].rate;if(0!==i){for(var n=60*a.getHours()+a.getMinutes(),s=0;s<r.length-1;s++)if(n>=r[s].minutes&&n<r[s+1].minutes){i=r[s].rate;break}return Math.round(1e3*i)/1e3}console.error("ERROR: bad basal schedule",e)}},191:(e,t,a)=>{"use strict";var r=a(466),i=a(635),n=a(663),s=a(249);e.exports=function(e,t,a){if(a)o=[];else{a=i(e);var o=i(e,240)}var u={treatments:a,profile:e.profile,calculate:n};e.autosens&&(u.autosens=e.autosens);var d={treatments:o,profile:e.profile,calculate:n},l=[];/(Z|[+-][0-2][0-9]:?[034][05])+/.test(e.clock)||console.error("Warning: clock input "+e.clock+" is unzoned; please pass clock-zoned.json instead");var m,p=r(e.clock),c=new Date(0).getTime(),f={};f.date=new Date(0).getTime(),a.forEach((function(e){e.insulin&&e.started_at?c=Math.max(c,e.started_at):"number"==typeof e.rate&&e.duration&&e.date>f.date&&((f=e).duration=Math.round(100*f.duration)/100)})),m=t?1:240;for(var v=0;v<m;v+=5){var g=new Date(p.getTime()+6e4*v),h=s(u,g),_=s(d,g);l.push(h),l[l.length-1].iobWithZeroTemp=_}return l[0].lastBolusTime=c,l[0].lastTemp=f,l}},249:(e,t)=>{"use strict";e.exports=function(e,t){var a,r=t.getTime(),i=e.calculate,n=e.treatments,s=e.profile,o=s.dia,u=0,d=0,l=0,m=0,p=0,c=0;if(!n)return{};o<3&&(o=3);var f={bilinear:{requireLongDia:!1,peak:75},"rapid-acting":{requireLongDia:!0,peak:75,tdMin:300},"ultra-rapid":{requireLongDia:!0,peak:55,tdMin:300}},v="bilinear";void 0!==s.curve&&(v=s.curve.toLowerCase()),v in f||(console.error('Unsupported curve function: "'+v+'". Supported curves: "bilinear", "rapid-acting" (Novolog, Novorapid, Humalog, Apidra) and "ultra-rapid" (Fiasp). Defaulting to "rapid-acting".'),v="rapid-acting");var g=f[v];return g.requireLongDia&&o<5&&(o=5),a=g.peak,n.forEach((function(e){if(e.date<=r){var n=r-60*o*60*1e3;if(e.date>n){var f=i(e,t,v,o,a,s);f&&f.iobContrib&&(u+=f.iobContrib),f&&f.activityContrib&&(c+=f.activityContrib),e.insulin&&f&&f.iobContrib&&(e.insulin<.1?(d+=f.iobContrib,m+=e.insulin):(l+=f.iobContrib,p+=e.insulin))}}})),{iob:Math.round(1e3*u)/1e3,activity:Math.round(1e4*c)/1e4,basaliob:Math.round(1e3*d)/1e3,bolusiob:Math.round(1e3*l)/1e3,netbasalinsulin:Math.round(1e3*m)/1e3,bolusinsulin:Math.round(1e3*p)/1e3,time:t}}},466:(e,t)=>{e.exports=function(e){if(void 0===e)return new Date;if(null===e)throw new TypeError("Null date input");if(e instanceof Date)return new Date(e.getTime());if("number"==typeof e){const t=new Date(e);if(!t)throw new TypeError(`Invalid date input: ${e}`);return t}if("string"==typeof e){const t=Date.parse(e);if(isNaN(t))throw new TypeError(`Invalid date input (string): ${e}`);return new Date(t)}throw new TypeError("Unsupported date input: "+typeof e)}},635:(e,t,a)=>{"use strict";var r=a(83),i=a(466);function n(e,t){var a=[e];if("recurring"===t.type){var r=60*e.started_at.getHours()+e.started_at.getMinutes(),n=r+e.duration;if(e.duration>30||r<t.minutes&&n>t.minutes||n>1440&&t.minutes<n-1440){var s=structuredClone(e),o=structuredClone(e),u=0;if(e.duration>30)u=30;else{var d=t.minutes;n>1440&&(d=1440),u=d-r}var l=new Date(i(e.started_at).getTime()+60*u*1e3);s.duration=u,o.duration=e.duration-u,o.timestamp=l.toISOString(),o.started_at=new Date(o.timestamp),o.date=o.started_at.getTime(),a=[s,o]}}return a}function s(e,t){for(var a=[e],r=!0;r;){var i=[];for(const e of a){r=!1;for(const a of t){const t=n(e,a);if(t.length>1){i.push(...t),r=!0;break}}r||i.push(e)}a=i}return a}e.exports=function(e,t){var a,n,o=e.history,u=(e.history24,e.profile),d=e.autosens,l=[],m=[],p=[],c=[],f=!1,v=!1,g=i(e.clock);if(e.history24)o=[].concat(e.history).concat(e.history24);for(var h=g,_=0;_<o.length;_++){var b={};"PumpSuspend"===(y=o[_])._type?(b.timestamp=y.timestamp,b.started_at=i(y.timestamp),b.date=b.started_at.getTime(),p.push(b)):"PumpResume"===y._type&&(b.timestamp=y.timestamp,b.started_at=i(y.timestamp),b.date=b.started_at.getTime(),c.push(b))}p.sort(((e,t)=>e.date-t.date)),c.sort(((e,t)=>e.date-t.date)),c.length>0&&(a=c[0].timestamp,(0===p.length||c[0].date<p[0].date)&&(f=!0));var T=0;for(_=0;_<p.length;_++){for(;T<c.length&&!(c[T].date>p[_].date);T++);if(T>=c.length&&!v){v=1,n=p[_].timestamp;break}p[_].duration=(c[T].date-p[_].date)/60/1e3}for(f||v||c.length===p.length?f&&!v&&c.length-1!==p.length?console.error("Mismatched number of resumes("+c.length+") and suspends("+p.length+") assuming suspended prior to history block!"):!f&&v&&c.length!==p.length-1?console.error("Mismatched number of resumes("+c.length+") and suspends("+p.length+") assuming suspended past end of history block!"):f&&v&&c.length!==p.length&&console.error("Mismatched number of resumes("+c.length+") and suspends("+p.length+") assuming suspended prior to and past end of history block!"):console.error("Mismatched number of resumes("+c.length+") and suspends("+p.length+")!"),_<p.length-1&&p.splice(_+1,p.length-_-1),_=0;_<o.length;_++){var y;if((y=o[_]).bolus&&"Bolus"===y.bolus._type)y=(b=y).bolus;y.created_at&&(y.timestamp=y.created_at);var k=i(y.timestamp);if(!(k>h))if(h=k,"Bolus"===y._type)(b={}).timestamp=y.timestamp,b.started_at=i(y.timestamp),b.started_at>g?process.stderr.write(" "+y.amount+"U @ "+b.started_at):(b.date=b.started_at.getTime(),b.insulin=y.amount,m.push(b));else if("Meal Bolus"===y.eventType||"Correction Bolus"===y.eventType||"Snack Bolus"===y.eventType||"Bolus Wizard"===y.eventType){(b={}).timestamp=y.created_at,b.started_at=i(b.timestamp),b.date=b.started_at.getTime(),b.insulin=y.insulin,m.push(b)}else if("xdrip"===y.enteredBy){(b={}).timestamp=y.timestamp,b.started_at=i(b.timestamp),b.date=b.started_at.getTime(),b.insulin=y.insulin,m.push(b)}else if("HAPP_App"===y.enteredBy&&y.insulin){(b={}).timestamp=y.created_at,b.started_at=i(b.timestamp),b.date=b.started_at.getTime(),b.insulin=y.insulin,m.push(b)}else if("Temp Basal"!==y.eventType||"HAPP_App"!==y.enteredBy&&"openaps://AndroidAPS"!==y.enteredBy){if("Temp Basal"===y.eventType){(b={}).rate=y.rate,b.duration=y.duration,void 0!==y.amount&&(b.rate=y.amount/y.duration*60),b.timestamp=y.timestamp,b.started_at=i(b.timestamp),b.date=b.started_at.getTime(),l.push(b)}else if("TempBasal"===y._type){if("percent"===y.temp)continue;var w,D=y.rate,M=y.timestamp;if(_>0&&o[_-1].timestamp===M&&"TempBasalDuration"===o[_-1]._type)w=o[_-1]["duration (min)"];else{for(var x=0;x<o.length;x++)if(o[x].timestamp===M&&"TempBasalDuration"===o[x]._type){w=o[x]["duration (min)"];break}void 0===w&&console.error("No duration found for "+D+" U/hr basal "+M,o[_-1],y,o[_+1])}(b={}).rate=D,b.timestamp=y.timestamp,b.started_at=i(b.timestamp),b.date=b.started_at.getTime(),b.duration=w,l.push(b)}}else{(b={}).rate=y.absolute,b.duration=y.duration,b.timestamp=y.created_at,b.started_at=i(b.timestamp),b.date=b.started_at.getTime(),l.push(b)}}for((b={rate:0}).started_at=new Date(g.getTime()+6e4),b.date=b.started_at.getTime(),b.duration=t||0,l.push(b),l.sort(((e,t)=>e.date-t.date)),_=0;_+1<l.length;_++)l[_].date+60*l[_].duration*1e3>l[_+1].date&&(l[_].duration=(l[_+1].date-l[_].date)/60/1e3,null===l[_+1].duration&&l.splice(_+1,1));var B=[];u.basalprofile.forEach((e=>{const t={type:"recurring",minutes:e.minutes};B.push(t)}));var P=[];l.forEach((e=>{P=P.concat(s(e,B))})),l.sort(((e,t)=>e.date-t.date));var C,S=!1;if(void 0!==u.suspend_zeros_iob&&(S=u.suspend_zeros_iob),S){var E=[];P.forEach((e=>{var t=function(e,t,a,r,n,s){var o=[],u=new Date(a).getTime(),d=new Date(n).getTime();if(r&&e.date<u&&(e.date+60*e.duration*1e3<u?e.duration=0:(e.duration=(e.date+60*e.duration*1e3-u)/60/1e3,e.started_at=i(a),e.date=u)),s&&d&&e.date+60*e.duration*1e3>d&&(e.date>d?e.duration=0:e.duration=(d-e.date)/60/1e3),o.push(e),0===e.duration)return o;for(var l=0;l<t.length;l++)for(var m=t[l],p=0;p<o.length;p++)if(o[p].date<=m.date&&o[p].date+60*o[p].duration*1e3>m.date){if(o[p].date+60*o[p].duration*1e3>m.date+60*m.duration*1e3){var c=structuredClone(o[p]),f=new Date(i(m.started_at).getTime()+60*m.duration*1e3);c.timestamp=f.toISOString(),c.started_at=i(c.timestamp),c.date=m.date+60*m.duration*1e3,c.duration=(o[p].date+60*o[p].duration*1e3-(m.date+60*m.duration*1e3))/60/1e3,o.push(c)}o[p].duration=(m.date-o[p].date)/60/1e3}else if(m.date<=o[p].date&&m.date+60*m.duration*1e3>o[p].date){o[p].duration=(o[p].date+60*o[p].duration*1e3-(m.date+60*m.duration*1e3))/60/1e3;var v=new Date(i(m.started_at).getTime()+60*m.duration*1e3);o[p].timestamp=v.toISOString(),o[p].started_at=i(o[p].timestamp),o[p].date=m.date+60*m.duration*1e3}return o}(e,p,a,f,n,v);E.push(...t)}));var I=[];p.forEach((e=>{void 0!==e.duration&&I.push({_type:"SuspendBasal",rate:0,duration:e.duration,date:e.date,started_at:e.started_at})}));var N=g.getTime()-288e5,L=new Date(a).getTime();if(f&&N<L){var A=[{_type:"SuspendBasal",rate:0,duration:(L-N)/60/1e3,date:H=(z=new Date(N)).getTime(),started_at:q=i(z)}];I=I.concat(A)}if(v){var z,H=(z=new Date(n)).getTime(),q=i(z);A=[{_type:"SuspendBasal",rate:0,duration:(g-H)/60/1e3,date:H,timestamp:n,started_at:q}];I=I.concat(A)}I.forEach((e=>{E=E.concat(s(e,B))}))}else E=P;for(E.sort(((e,t)=>e.date-t.date)),_=0;_<E.length;_++){var O=E[_];if(O.duration>0){var R,U,W=u.current_basal;u.basalprofile&&u.basalprofile.length>0&&(W=r.basalLookup(u.basalprofile,new Date(O.timestamp))),void 0!==u.min_bg&&void 0!==u.max_bg&&(R=(u.min_bg+u.max_bg)/2);var Z=u;if(Z.half_basal_exercise_target)var $=Z.half_basal_exercise_target;else $=160;if(Z.exercise_mode&&Z.temptargetSet&&R>=105){var j=$-100;U=j/(j+R-100)}else void 0!==d&&(U=d.ratio);U&&(W*=U);var F=O.rate-W;C=F<0?-.05:.05;var G=Math.round(F*O.duration*10/6)/100,J=Math.round(G/C),K=O.duration/J;for(T=0;T<J;T++){var Q={};Q.insulin=C,Q.date=O.date+T*K*60*1e3,Q.created_at=new Date(Q.date),m.push(Q)}}}var V=[].concat(m).concat(l);return V.sort(((e,t)=>e.date-t.date)),V}},663:(e,t)=>{"use strict";e.exports=function(e,t,a,r,i,n){if(e.insulin){void 0===t&&(t=new Date);var s=new Date(e.date),o=Math.round((t-s)/1e3/60);return"bilinear"===a?function(e,t,a){var r=75,i=180,n=3/a,s=n*t,o=0,u=0,d=2/(60*a),l=d/r,m=d/(i-r)*-1;if(s<r){o=e.insulin*(l*s);var p=s/5+1;u=e.insulin*(-.001852*p*p+.001852*p+1)}else if(s<i){var c=s-r;o=e.insulin*(d+m*c);var f=(s-r)/5;u=e.insulin*(.001323*f*f+-.054233*f+.55556)}return{activityContrib:o,iobContrib:u}}(e,o,r):function(e,t,a,r,i){"rapid-acting"===i.curve?!0===i.useCustomPeakTime&&void 0!==i.insulinPeakTime?i.insulinPeakTime>120?(console.error("Setting maximum Insulin Peak Time of 120m for",i.curve,"insulin"),r=120):i.insulinPeakTime<50?(console.error("Setting minimum Insulin Peak Time of 50m for",i.curve,"insulin"),r=50):r=i.insulinPeakTime:r=75:"ultra-rapid"===i.curve?!0===i.useCustomPeakTime&&void 0!==i.insulinPeakTime?i.insulinPeakTime>100?(console.error("Setting maximum Insulin Peak Time of 100m for",i.curve,"insulin"),r=100):i.insulinPeakTime<35?(console.error("Setting minimum Insulin Peak Time of 35m for",i.curve,"insulin"),r=35):r=i.insulinPeakTime:r=55:console.error("Curve of",i.curve,"is not supported.");var n=60*a,s=0,o=0;if(t<n){var u=r*(1-r/n)/(1-2*r/n),d=2*u/n,l=1/(1-d+(1+d)*Math.exp(-n/u));s=e.insulin*(l/Math.pow(u,2))*t*(1-t/n)*Math.exp(-t/u),o=e.insulin*(1-l*(1-d)*((Math.pow(t,2)/(u*n*(1-d))-t/u-1)*Math.exp(-t/u)+1))}return{activityContrib:s,iobContrib:o}}(e,o,r,i,n)}return{}}}},t={};var a=function a(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,a),n.exports}(191);freeaps_iob=a})();