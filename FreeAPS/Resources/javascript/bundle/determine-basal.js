var freeaps_determineBasal;(()=>{var e={5546:(e,r,a)=>{var t=a(6880);function n(e,r){r||(r=0);var a=Math.pow(10,r);return Math.round(e*a)/a}function o(e,r){return"mmol/L"===r.out_units?n(e/18,1):Math.round(e)}e.exports=function(e,r,a,s,i,l,m,u,d,c){var h={},g=new Date;if(c&&(g=c),void 0===s||void 0===s.current_basal)return h.error="Error: could not get current basal rate",h;var p=t(s.current_basal,s),b=p,B=new Date;c&&(B=c);var f,v=new Date(e.date),M=n((B-v)/60/1e3,1),_=e.glucose,x=e.noise;f=e.delta>-.5?"+"+n(e.delta,0):n(e.delta,0);var G=Math.min(e.delta,e.short_avgdelta),C=Math.min(e.short_avgdelta,e.long_avgdelta),S=Math.max(e.delta,e.short_avgdelta,e.long_avgdelta);(_<=10||38===_||x>=3)&&(h.reason="CGM is calibrating, in ??? state, or noise is high");var w=!1;if(_>60&&0==e.delta&&e.short_avgdelta>-1&&e.short_avgdelta<1&&e.long_avgdelta>-1&&e.long_avgdelta<1&&("fakecgm"==e.device?(console.error("CGM data is unchanged ("+_+"+"+e.delta+") for 5m w/ "+e.short_avgdelta+" mg/dL ~15m change & "+e.long_avgdelta+" mg/dL ~45m change"),console.error("Simulator mode detected (",e.device,"): continuing anyway")):w=!0),M>12||M<-5?h.reason="If current system time "+B+" is correct, then BG data is too old. The last BG data was read "+M+"m ago at "+v:w&&(e.last_cal&&e.last_cal<3?h.reason="CGM was just calibrated":h.reason="CGM data is unchanged ("+_+"+"+e.delta+") for 5m w/ "+e.short_avgdelta+" mg/dL ~15m change & "+e.long_avgdelta+" mg/dL ~45m change"),_<=10||38===_||x>=3||M>12||M<-5||w)return r.rate>b?(h.reason+=". Replacing high temp basal of "+r.rate+" with neutral temp of "+b,h.deliverAt=g,h.temp="absolute",h.duration=30,h.rate=b,h):0===r.rate&&r.duration>30?(h.reason+=". Shortening "+r.duration+"m long zero temp to 30m. ",h.deliverAt=g,h.temp="absolute",h.duration=30,h.rate=0,h):(h.reason+=". Temp "+r.rate+" <= current basal "+b+"U/hr; doing nothing. ",h);var y,O,T,A,U,I=s.max_iob;if(void 0!==s.min_bg&&(O=s.min_bg),void 0!==s.max_bg&&(T=s.max_bg),void 0!==s.enableSMB_high_bg_target&&(A=s.enableSMB_high_bg_target),void 0===s.min_bg||void 0===s.max_bg)return h.error="Error: could not determine target_bg. ",h;y=(s.min_bg+s.max_bg)/2;var D=s.exercise_mode||s.high_temptarget_raises_sensitivity,j=100;if(s.half_basal_exercise_target)var F=s.half_basal_exercise_target;else F=160;if(D&&s.temptargetSet&&y>j||s.low_temptarget_lowers_sensitivity&&s.temptargetSet&&y<j){var W=F-j;U=W*(W+y-j)<=0?s.autosens_max:W/(W+y-j),U=n(U=Math.min(U,s.autosens_max),2),process.stderr.write("Sensitivity ratio set to "+U+" based on temp target of "+y+"; ")}else void 0!==i&&i&&(U=i.ratio,process.stderr.write("Autosens ratio: "+U+"; "));if(U&&(b=s.current_basal*U,(b=t(b,s))!==p?process.stderr.write("Adjusting basal from "+p+" to "+b+"; "):process.stderr.write("Basal unchanged: "+b+"; ")),s.temptargetSet);else if(void 0!==i&&i&&(s.sensitivity_raises_target&&i.ratio<1||s.resistance_lowers_target&&i.ratio>1)){O=n((O-60)/i.ratio)+60,T=n((T-60)/i.ratio)+60;var E=n((y-60)/i.ratio)+60;y===(E=Math.max(80,E))?process.stderr.write("target_bg unchanged: "+E+"; "):process.stderr.write("target_bg from "+y+" to "+E+"; "),y=E}if(e.noise>=2){var q=Math.max(1.1,s.noisyCGMTargetMultiplier),R=(Math.min(250,s.maxRaw),n(Math.min(200,O*q))),z=n(Math.min(200,y*q)),k=n(Math.min(200,T*q));process.stderr.write("Raising target_bg for noisy / raw CGM data, from "+y+" to "+z+"; "),O=R,y=z,T=k}var L=65;s.threshold_setting&&(L=s.threshold_setting);var P=Math.max(O-.5*(O-40),L);process.stderr.write("Glucose threshold: "+o(P,s));var N=n(s.sens,1),H=s.sens;if(void 0!==i&&i&&((H=n(H=s.sens/U,1))!==N?process.stderr.write("ISF from "+N+" to "+H):process.stderr.write("ISF unchanged: "+H)),console.error("; CR:",s.carb_ratio),void 0===a)return h.error="Error: iob_data undefined. ",h;var Z,$=a;if(a.length,a.length>1&&(a=$[0]),void 0===a.activity||void 0===a.iob)return h.error="Error: iob_data missing some property. ",h;var J=((Z=void 0!==a.lastTemp?n((new Date(B).getTime()-a.lastTemp.date)/6e4):0)+r.duration)%30;if(console.error("currenttemp:",r,"lastTempAge:",Z,"m","tempModulus:",J,"m"),h.temp="absolute",h.deliverAt=g,u&&r&&a.lastTemp&&r.rate!==a.lastTemp.rate&&Z>10&&r.duration)return h.reason="Warning: currenttemp rate "+r.rate+" != lastTemp rate "+a.lastTemp.rate+" from pumphistory; canceling temp",m.setTempBasal(0,0,s,h,r);if(r&&a.lastTemp&&r.duration>0){var K=Z-a.lastTemp.duration;if(K>5&&Z>10)return h.reason="Warning: currenttemp running but lastTemp from pumphistory ended "+K+"m ago; canceling temp",m.setTempBasal(0,0,s,h,r)}var Q=n(-a.activity*H*5,2),V=n(6*(G-Q));if(V<0&&(V=n(6*(C-Q)))<0&&(V=n(6*(e.long_avgdelta-Q))),a.iob>0)var X=n(_-a.iob*H);else X=n(_-a.iob*Math.min(H,s.sens));var Y=X+V;if(void 0===Y||isNaN(Y))return h.error="Error: could not calculate eventualBG. ",h;var ee=function(e,r,a){return n(a+(e-r)/24,1)}(y,Y,Q);h={temp:"absolute",bg:_,tick:f,eventualBG:Y,insulinReq:0,reservoir:d,deliverAt:g,sensitivityRatio:U};var re=[],ae=[],te=[],ne=[];re.push(_),ae.push(_),ne.push(_),te.push(_);var oe=function(e,r,a,t,n,s){return r?!e.allowSMB_with_high_temptarget&&e.temptargetSet&&n>100?(console.error("SMB disabled due to high temptarget of",n),!1):!0===a.bwFound&&!1===e.A52_risk_enable?(console.error("SMB disabled due to Bolus Wizard activity in the last 6 hours."),!1):!0===e.enableSMB_always?(a.bwFound?console.error("Warning: SMB enabled within 6h of using Bolus Wizard: be sure to easy bolus 30s before using Bolus Wizard"):console.error("SMB enabled due to enableSMB_always"),!0):!0===e.enableSMB_with_COB&&a.mealCOB?(a.bwCarbs?console.error("Warning: SMB enabled with Bolus Wizard carbs: be sure to easy bolus 30s before using Bolus Wizard"):console.error("SMB enabled for COB of",a.mealCOB),!0):!0===e.enableSMB_after_carbs&&a.carbs?(a.bwCarbs?console.error("Warning: SMB enabled with Bolus Wizard carbs: be sure to easy bolus 30s before using Bolus Wizard"):console.error("SMB enabled for 6h after carb entry"),!0):!0===e.enableSMB_with_temptarget&&e.temptargetSet&&n<100?(a.bwFound?console.error("Warning: SMB enabled within 6h of using Bolus Wizard: be sure to easy bolus 30s before using Bolus Wizard"):console.error("SMB enabled for temptarget of",o(n,e)),!0):!0===e.enableSMB_high_bg&&null!==s&&t>=s?(console.error("Checking BG to see if High for SMB enablement."),console.error("Current BG",t," | High BG ",s),a.bwFound?console.error("Warning: High BG SMB enabled within 6h of using Bolus Wizard: be sure to easy bolus 30s before using Bolus Wizard"):console.error("High BG detected. Enabling SMB."),!0):(console.error("SMB disabled (no enableSMB preferences active or no condition satisfied)"),!1):(console.error("SMB disabled (!microBolusAllowed)"),!1)}(s,u,l,_,y,A),se=s.enableUAM,ie=0,le=0;ie=n(G-Q,1);var me=n(G-Q,1),ue=H/s.carb_ratio;console.error("profile.sens:",s.sens,"sens:",H,"CSF:",ue);var de=n(30*ue*5/60,1);ie>de&&(console.error("Limiting carb impact from",ie,"to",de,"mg/dL/5m (",30,"g/h )"),ie=de);var ce=3;U&&(ce/=U);var he=ce;if(l.carbs){ce=Math.max(ce,l.mealCOB/20);var ge=n((new Date(B).getTime()-l.lastCarbTime)/6e4),pe=(l.carbs-l.mealCOB)/l.carbs;he=n(he=ce+1.5*ge/60,1),console.error("Last carbs",ge,"minutes ago; remainingCATime:",he,"hours;",n(100*pe)+"% carbs absorbed")}var be=Math.max(0,ie/5*60*he/2)/ue,Be=90,fe=1;s.remainingCarbsCap&&(Be=Math.min(90,s.remainingCarbsCap)),s.remainingCarbsFraction&&(fe=Math.min(1,s.remainingCarbsFraction));var ve=1-fe,Me=Math.max(0,l.mealCOB-be-l.carbs*ve),_e=(Me=Math.min(Be,Me))*ue*5/60/(he/2),xe=n(l.slopeFromMaxDeviation,2),Ge=n(l.slopeFromMinDeviation,2),Ce=Math.min(xe,-Ge/3);le=0===ie?0:Math.min(60*he/5/2,Math.max(0,l.mealCOB*ue/ie)),console.error("Carb Impact:",ie,"mg/dL per 5m; CI Duration:",n(5*le/60*2,1),"hours; remaining CI (",he," peak):",n(_e,1),"mg/dL per 5m");var Se,we,ye,Oe,Te,Ae=999,Ue=999,Ie=999,De=_,je=999,Fe=999,We=999,Ee=999,qe=Y,Re=_,ze=_,ke=0,Le=[],Pe=[];try{$.forEach((function(e){var r=n(-e.activity*H*5,2),a=n(-e.iobWithZeroTemp.activity*H*5,2),t=ie*(1-Math.min(1,ae.length/12));qe=ae[ae.length-1]+r+t;var o=ne[ne.length-1]+a,s=Math.max(0,Math.max(0,ie)*(1-re.length/Math.max(2*le,1))),i=Math.min(re.length,12*he-re.length),l=Math.max(0,i/(he/2*12)*_e);s+l,Le.push(n(l,0)),Pe.push(n(s,0)),COBpredBG=re[re.length-1]+r+Math.min(0,t)+s+l;var m=Math.max(0,me+te.length*Ce),u=Math.max(0,me*(1-te.length/Math.max(36,1))),d=Math.min(m,u);d>0&&(ke=n(5*(te.length+1)/60,1)),UAMpredBG=te[te.length-1]+r+Math.min(0,t)+d,ae.length<48&&ae.push(qe),re.length<48&&re.push(COBpredBG),te.length<48&&te.push(UAMpredBG),ne.length<48&&ne.push(o),COBpredBG<je&&(je=n(COBpredBG)),UAMpredBG<Fe&&(Fe=n(UAMpredBG)),qe<We&&(We=n(qe)),o<Ee&&(Ee=n(o));ae.length>18&&qe<Ae&&(Ae=n(qe)),qe>Re&&(Re=qe),(le||_e>0)&&re.length>18&&COBpredBG<Ue&&(Ue=n(COBpredBG)),(le||_e>0)&&COBpredBG>Re&&(ze=COBpredBG),se&&te.length>12&&UAMpredBG<Ie&&(Ie=n(UAMpredBG)),se&&UAMpredBG>Re&&UAMpredBG}))}catch(e){console.error("Problem with iobArray.  Optional feature Advanced Meal Assist disabled")}l.mealCOB&&(console.error("predCIs (mg/dL/5m):",Pe.join(" ")),console.error("remainingCIs:      ",Le.join(" "))),h.predBGs={},ae.forEach((function(e,r,a){a[r]=n(Math.min(401,Math.max(39,e)))}));for(var Ne=ae.length-1;Ne>12&&ae[Ne-1]===ae[Ne];Ne--)ae.pop();for(h.predBGs.IOB=ae,ye=n(ae[ae.length-1]),ne.forEach((function(e,r,a){a[r]=n(Math.min(401,Math.max(39,e)))})),Ne=ne.length-1;Ne>6&&!(ne[Ne-1]>=ne[Ne]||ne[Ne]<=y);Ne--)ne.pop();if(h.predBGs.ZT=ne,n(ne[ne.length-1]),l.mealCOB>0&&(ie>0||_e>0)){for(re.forEach((function(e,r,a){a[r]=n(Math.min(401,Math.max(39,e)))})),Ne=re.length-1;Ne>12&&re[Ne-1]===re[Ne];Ne--)re.pop();h.predBGs.COB=re,Oe=n(re[re.length-1]),Y=Math.max(Y,n(re[re.length-1]))}if(ie>0||_e>0){if(se){for(te.forEach((function(e,r,a){a[r]=n(Math.min(401,Math.max(39,e)))})),Ne=te.length-1;Ne>12&&te[Ne-1]===te[Ne];Ne--)te.pop();h.predBGs.UAM=te,Te=n(te[te.length-1]),te[te.length-1]&&(Y=Math.max(Y,n(te[te.length-1])))}h.eventualBG=Y}console.error("UAM Impact:",me,"mg/dL per 5m; UAM Duration:",ke,"hours"),Ae=Math.max(39,Ae),Ue=Math.max(39,Ue),Ie=Math.max(39,Ie),Se=n(Ae);var He=l.mealCOB/l.carbs;we=n(Ie<999&&Ue<999?(1-He)*UAMpredBG+He*COBpredBG:Ue<999?(qe+COBpredBG)/2:Ie<999?(qe+UAMpredBG)/2:qe),Ee>we&&(we=Ee),De=n(De=le||_e>0?se?He*je+(1-He)*Fe:je:se?Fe:We);var Ze=Ie;if(Ee<P)Ze=(Ie+Ee)/2;else if(Ee<y){var $e=(Ee-P)/(y-P);Ze=(Ie+(Ie*$e+Ee*(1-$e)))/2}else Ee>Ie&&(Ze=(Ie+Ee)/2);if(Ze=n(Ze),l.carbs)if(!se&&Ue<999)Se=n(Math.max(Ae,Ue));else if(Ue<999){var Je=He*Ue+(1-He)*Ze;Se=n(Math.max(Ae,Ue,Je))}else Se=se?Ze:De;else se&&(Se=n(Math.max(Ae,Ze)));Se=Math.min(Se,we),process.stderr.write("minPredBG: "+Se+" minIOBPredBG: "+Ae+" minZTGuardBG: "+Ee),Ue<999&&process.stderr.write(" minCOBPredBG: "+Ue),Ie<999&&process.stderr.write(" minUAMPredBG: "+Ie),console.error(" avgPredBG:",we,"COB:",l.mealCOB,"/",l.carbs),ze>_&&(Se=Math.min(Se,ze)),h.COB=l.mealCOB,h.IOB=a.iob,h.BGI=o(Q,s),h.deviation=o(V,s),h.ISF=o(H,s),h.CR=n(s.carb_ratio,2),h.target_bg=o(y,s),h.reason="COB: "+h.COB+", Dev: "+h.deviation+", BGI: "+h.BGI+", ISF: "+h.ISF+", CR: "+h.CR+", minPredBG: "+o(Se,s)+", minGuardBG: "+o(De,s)+", IOBpredBG: "+o(ye,s),Oe>0&&(h.reason+=", COBpredBG: "+o(Oe,s)),Te>0&&(h.reason+=", UAMpredBG: "+o(Te,s)),h.reason+="; ";var Ke=X;Ke<40&&(Ke=Math.min(De,Ke));var Qe,Ve=P-Ke,Xe=240,Ye=240;if(l.mealCOB>0&&(ie>0||_e>0)){for(Ne=0;Ne<re.length;Ne++)if(re[Ne]<O){Xe=5*Ne;break}for(Ne=0;Ne<re.length;Ne++)if(re[Ne]<P){Ye=5*Ne;break}}else{for(Ne=0;Ne<ae.length;Ne++)if(ae[Ne]<O){Xe=5*Ne;break}for(Ne=0;Ne<ae.length;Ne++)if(ae[Ne]<P){Ye=5*Ne;break}}oe&&De<P&&(console.error("minGuardBG",o(De,s),"projected below",o(P,s),"- disabling SMB"),oe=!1),void 0===s.maxDelta_bg_threshold&&(Qe=.2),void 0!==s.maxDelta_bg_threshold&&(Qe=Math.min(s.maxDelta_bg_threshold,.3)),S>Qe*_&&(console.error("maxDelta "+o(S,s)+" > "+100*Qe+"% of BG "+o(_,s)+" - disabling SMB"),h.reason+="maxDelta "+o(S,s)+" > "+100*Qe+"% of BG "+o(_,s)+": SMB disabled; ",oe=!1),console.error("BG projected to remain above",o(O,s),"for",Xe,"minutes"),(Ye<240||Xe<60)&&console.error("BG projected to remain above",o(P,s),"for",Ye,"minutes");var er=Ye,rr=s.current_basal*H*er/60,ar=(Ve-rr)/ue-Math.max(0,l.mealCOB-.25*l.carbs);if(rr=n(rr),ar=n(ar),console.error("naive_eventualBG: "+o(X,s)+", bgUndershoot: "+o(Ve,s)+", zeroTempDuration: "+er+", zeroTempEffect: "+rr+", carbsReq: "+ar),"Could not parse clock data"==l.reason?console.error("carbsReq unknown: Could not parse clock data"):ar>=s.carbsReqThreshold&&Ye<=45&&(h.carbsReq=ar,h.reason+=ar+" add'l carbs req w/in "+Ye+"m; "),_<P&&a.iob<20*-s.current_basal/60&&G>0&&G>ee)h.reason+="IOB "+a.iob+" < "+n(20*-s.current_basal/60,2),h.reason+=" and minDelta "+o(G,s)+" > expectedDelta "+o(ee,s)+"; ";else if(_<P||De<P){h.reason+="minGuardBG: "+o(De,s)+"<"+o(P,s);var tr=(Ve=y-De)/H,nr=n(60*tr/s.current_basal);return nr=30*n(nr/30),nr=Math.min(120,Math.max(30,nr)),m.setTempBasal(0,nr,s,h,r)}if(s.skip_neutral_temps&&h.deliverAt.getMinutes()>=55)return h.reason+="; Canceling temp at "+h.deliverAt.getMinutes()+"m past the hour. ",m.setTempBasal(0,0,s,h,r);if(Y<O){if(h.reason+="Eventual BG "+o(Y,s)+" < "+o(O,s),G>ee&&G>0&&!ar)return X<40?(h.reason+=", naive_eventualBG < 40. ",m.setTempBasal(0,30,s,h,r)):(e.delta>G?h.reason+=", but Delta "+o(f,s)+" > expectedDelta "+o(ee,s):h.reason+=", but Min. Delta "+G.toFixed(2)+" > Exp. Delta "+o(ee,s),r.duration>15&&t(b,s)===t(r.rate,s)?(h.reason+=", temp "+r.rate+" ~ req "+b+"U/hr. ",h):(h.reason+="; setting current basal of "+b+" as temp. ",m.setTempBasal(b,30,s,h,r)));var or=2*Math.min(0,(Y-y)/H);or=n(or,2);var sr=Math.min(0,(X-y)/H);if(sr=n(sr,2),G<0&&G>ee)or=n(or*(G/ee),2);var ir=b+2*or;ir=t(ir,s);var lr=r.duration*(r.rate-b)/60;if(lr<Math.min(or,sr)-.3*b)return h.reason+=", "+r.duration+"m@"+r.rate.toFixed(2)+" is a lot less than needed. ",m.setTempBasal(ir,30,s,h,r);if(void 0!==r.rate&&r.duration>5&&ir>=.8*r.rate)return h.reason+=", temp "+r.rate+" ~< req "+ir+"U/hr. ",h;if(ir<=0){if((nr=n(60*(tr=(Ve=y-X)/H)/s.current_basal))<0?nr=0:(nr=30*n(nr/30),nr=Math.min(120,Math.max(0,nr))),nr>0)return h.reason+=", setting "+nr+"m zero temp. ",m.setTempBasal(ir,nr,s,h,r)}else h.reason+=", setting "+ir+"U/hr. ";return m.setTempBasal(ir,30,s,h,r)}if(G<ee&&(!u||!oe))return e.delta<G?h.reason+="Eventual BG "+o(Y,s)+" > "+o(O,s)+" but Delta "+o(f,s)+" < Exp. Delta "+o(ee,s):h.reason+="Eventual BG "+o(Y,s)+" > "+o(O,s)+" but Min. Delta "+G.toFixed(2)+" < Exp. Delta "+o(ee,s),r.duration>15&&t(b,s)===t(r.rate,s)?(h.reason+=", temp "+r.rate+" ~ req "+b+"U/hr. ",h):(h.reason+="; setting current basal of "+b+" as temp. ",m.setTempBasal(b,30,s,h,r));if(Math.min(Y,Se)<T&&(!u||!oe))return h.reason+=o(Y,s)+"-"+o(Se,s)+" in range: no temp required",r.duration>15&&t(b,s)===t(r.rate,s)?(h.reason+=", temp "+r.rate+" ~ req "+b+"U/hr. ",h):(h.reason+="; setting current basal of "+b+" as temp. ",m.setTempBasal(b,30,s,h,r));if(Y>=T&&(h.reason+="Eventual BG "+o(Y,s)+" >= "+o(T,s)+", "),a.iob>I)return h.reason+="IOB "+n(a.iob,2)+" > max_iob "+I,r.duration>15&&t(b,s)===t(r.rate,s)?(h.reason+=", temp "+r.rate+" ~ req "+b+"U/hr. ",h):(h.reason+="; setting current basal of "+b+" as temp. ",m.setTempBasal(b,30,s,h,r));(or=n((Math.min(Se,Y)-y)/H,2))>I-a.iob&&(h.reason+="max_iob "+I+", ",or=I-a.iob),ir=t(ir=b+2*or,s),or=n(or,3),h.insulinReq=or;var mr=n((new Date(B).getTime()-a.lastBolusTime)/6e4,1);if(u&&oe&&_>P){var ur=n(l.mealCOB/s.carb_ratio,3);if(void 0===s.maxSMBBasalMinutes){var dr=n(30*s.current_basal/60,1);console.error("profile.maxSMBBasalMinutes undefined: defaulting to 30m")}else a.iob>ur&&a.iob>0?(console.error("IOB",a.iob,"> COB",l.mealCOB+"; mealInsulinReq =",ur),s.maxUAMSMBBasalMinutes?(console.error("profile.maxUAMSMBBasalMinutes:",s.maxUAMSMBBasalMinutes,"profile.current_basal:",s.current_basal),dr=n(s.current_basal*s.maxUAMSMBBasalMinutes/60,1)):(console.error("profile.maxUAMSMBBasalMinutes undefined: defaulting to 30m"),dr=n(30*s.current_basal/60,1))):(console.error("profile.maxSMBBasalMinutes:",s.maxSMBBasalMinutes,"profile.current_basal:",s.current_basal),dr=n(s.current_basal*s.maxSMBBasalMinutes/60,1));var cr=.5;s.smb_delivery_ratio&&(cr=Math.min(Math.max(s.smb_delivery_ratio,.1),1),process.stderr.write("SMB Ratio: "+cr)),bolusIncrement=.1,s.bolus_increment&&(bolusIncrement=s.bolus_increment);var hr=1/bolusIncrement,gr=Math.floor(Math.min(or*cr,dr)*hr)/hr;nr=n(60*(tr=(y-(X+Ae)/2)/H)/s.current_basal),or>0&&gr<bolusIncrement&&(nr=0);var pr=0;nr<=0?nr=0:nr>=30?(nr=30*n(nr/30),nr=Math.min(60,Math.max(0,nr))):(pr=n(b*nr/30,2),nr=30),h.reason+=" insulinReq "+or,gr>=dr&&(h.reason+="; maxBolus "+dr),nr>0&&(h.reason+="; setting "+nr+"m low temp of "+pr+"U/h"),h.reason+=". ";var br=3;s.SMBInterval&&(br=Math.min(10,Math.max(1,s.SMBInterval)));var Br=n(br-mr,0),fr=n(60*(br-mr),0)%60;if(console.error("naive_eventualBG "+o(X,s)+", "+nr+"m "+pr+"U/h temp needed; last bolus "+mr+"m ago; maxBolus: "+dr),mr>br?gr>0&&(h.units=gr,h.reason+="Microbolusing "+gr+"U. "):h.reason+="Waiting "+Br+"m "+fr+"s to microbolus again. ",nr>0)return h.rate=pr,h.duration=nr,h}var vr=m.getMaxSafeBasal(s);return ir>vr&&(h.reason+="adj. req. rate: "+ir+" to maxSafeBasal: "+vr+", ",ir=t(vr,s)),(lr=r.duration*(r.rate-b)/60)>=2*or?(h.reason+=r.duration+"m@"+r.rate.toFixed(2)+" > 2 * insulinReq. Setting temp basal of "+ir+"U/hr. ",m.setTempBasal(ir,30,s,h,r)):void 0===r.duration||0===r.duration?(h.reason+="no temp, setting "+ir+"U/hr. ",m.setTempBasal(ir,30,s,h,r)):r.duration>5&&t(ir,s)<=t(r.rate,s)?(h.reason+="temp "+r.rate+" >~ req "+ir+"U/hr. ",h):(h.reason+="temp "+r.rate+"<"+ir+"U/hr. ",m.setTempBasal(ir,30,s,h,r))}},6880:(e,r,a)=>{var t=a(6654);e.exports=function(e,r){var a=20;void 0!==r&&"string"==typeof r.model&&(t(r.model,"54")||t(r.model,"23"))&&(a=40);return e<1?Math.round(e*a)/a:e<10?Math.round(20*e)/20:Math.round(10*e)/10}},2705:(e,r,a)=>{var t=a(5639).Symbol;e.exports=t},9932:e=>{e.exports=function(e,r){for(var a=-1,t=null==e?0:e.length,n=Array(t);++a<t;)n[a]=r(e[a],a,e);return n}},9750:e=>{e.exports=function(e,r,a){return e==e&&(void 0!==a&&(e=e<=a?e:a),void 0!==r&&(e=e>=r?e:r)),e}},4239:(e,r,a)=>{var t=a(2705),n=a(9607),o=a(2333),s=t?t.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":s&&s in Object(e)?n(e):o(e)}},531:(e,r,a)=>{var t=a(2705),n=a(9932),o=a(1469),s=a(3448),i=t?t.prototype:void 0,l=i?i.toString:void 0;e.exports=function e(r){if("string"==typeof r)return r;if(o(r))return n(r,e)+"";if(s(r))return l?l.call(r):"";var a=r+"";return"0"==a&&1/r==-Infinity?"-0":a}},7561:(e,r,a)=>{var t=a(7990),n=/^\s+/;e.exports=function(e){return e?e.slice(0,t(e)+1).replace(n,""):e}},1957:(e,r,a)=>{var t="object"==typeof a.g&&a.g&&a.g.Object===Object&&a.g;e.exports=t},9607:(e,r,a)=>{var t=a(2705),n=Object.prototype,o=n.hasOwnProperty,s=n.toString,i=t?t.toStringTag:void 0;e.exports=function(e){var r=o.call(e,i),a=e[i];try{e[i]=void 0;var t=!0}catch(e){}var n=s.call(e);return t&&(r?e[i]=a:delete e[i]),n}},2333:e=>{var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},5639:(e,r,a)=>{var t=a(1957),n="object"==typeof self&&self&&self.Object===Object&&self,o=t||n||Function("return this")();e.exports=o},7990:e=>{var r=/\s/;e.exports=function(e){for(var a=e.length;a--&&r.test(e.charAt(a)););return a}},6654:(e,r,a)=>{var t=a(9750),n=a(531),o=a(554),s=a(9833);e.exports=function(e,r,a){e=s(e),r=n(r);var i=e.length,l=a=void 0===a?i:t(o(a),0,i);return(a-=r.length)>=0&&e.slice(a,l)==r}},1469:e=>{var r=Array.isArray;e.exports=r},3218:e=>{e.exports=function(e){var r=typeof e;return null!=e&&("object"==r||"function"==r)}},7005:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},3448:(e,r,a)=>{var t=a(4239),n=a(7005);e.exports=function(e){return"symbol"==typeof e||n(e)&&"[object Symbol]"==t(e)}},8601:(e,r,a)=>{var t=a(4841),n=1/0;e.exports=function(e){return e?(e=t(e))===n||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},554:(e,r,a)=>{var t=a(8601);e.exports=function(e){var r=t(e),a=r%1;return r==r?a?r-a:r:0}},4841:(e,r,a)=>{var t=a(7561),n=a(3218),o=a(3448),s=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,l=/^0o[0-7]+$/i,m=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return NaN;if(n(e)){var r="function"==typeof e.valueOf?e.valueOf():e;e=n(r)?r+"":r}if("string"!=typeof e)return 0===e?e:+e;e=t(e);var a=i.test(e);return a||l.test(e)?m(e.slice(2),a?2:8):s.test(e)?NaN:+e}},9833:(e,r,a)=>{var t=a(531);e.exports=function(e){return null==e?"":t(e)}}},r={};function a(t){var n=r[t];if(void 0!==n)return n.exports;var o=r[t]={exports:{}};return e[t](o,o.exports,a),o.exports}a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();var t=a(5546);freeaps_determineBasal=t})();