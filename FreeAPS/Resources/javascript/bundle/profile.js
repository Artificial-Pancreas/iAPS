var freeaps_profile;(()=>{"use strict";var e={83:(e,t)=>{t.maxDailyBasal=function(e){var t=e.basals.length?e.basals.reduce(((e,t)=>Number(t.rate)>Number(e.rate)?t:e)):null;return 1e3*Number(t.rate)/1e3},t.maxBasalLookup=function(e){return e.settings.maxBasal},t.basalLookup=function(e,t){var a=t;void 0===t&&(a=new Date);var r=e.slice().sort(((e,t)=>e.i-t.i)),s=r[r.length-1].rate;if(0!==s){for(var i=60*a.getHours()+a.getMinutes(),n=0;n<r.length-1;n++)if(i>=r[n].minutes&&i<r[n+1].minutes){s=r[n].rate;break}return Math.round(1e3*s)/1e3}console.error("ERROR: bad basal schedule",e)}},141:(e,t,a)=>{var r=a(304),s=a(511).console_error;function i(e,t,a){var i=new Date,n=t.carbratio;if(void 0===n||void 0===n.schedule);else{var _;if("grams"===n.units||"exchanges"===n.units){_=n.schedule[n.schedule.length-1];for(var o=0;o<n.schedule.length-1;o++)if(i>=r(n.schedule[o].offset)&&i<r(n.schedule[o+1].offset)){if((_=n.schedule[o])<3||_>150)return void s(e,"Error: carbRatio of "+_+" out of bounds.");break}return"exchanges"===n.units&&(_.ratio=12/_.ratio),_.ratio}s(e,"Error: Unsupported carb_ratio units "+n.units)}}i.carbRatioLookup=i,e.exports=i},304:(e,t)=>{e.exports=function(e){var t=new Date;return t.setHours("00"),t.setMinutes("00"),t.setSeconds("00"),t.getTime()+60*e*1e3}},452:(e,t,a)=>{var r=a(83),s=a(590),i=a(497),n=a(141),_=a(511),o=_.console_error;_.console_log;function l(){return{max_iob:0,max_daily_safety_multiplier:3,current_basal_safety_multiplier:4,autosens_max:1.2,autosens_min:.7,rewind_resets_autosens:!0,high_temptarget_raises_sensitivity:!1,low_temptarget_lowers_sensitivity:!1,sensitivity_raises_target:!0,resistance_lowers_target:!1,exercise_mode:!1,half_basal_exercise_target:160,maxCOB:120,skip_neutral_temps:!1,unsuspend_if_no_temp:!1,bolussnooze_dia_divisor:2,min_5m_carbimpact:8,autotune_isf_adjustmentFraction:1,remainingCarbsFraction:1,remainingCarbsCap:90,enableUAM:!0,A52_risk_enable:!1,enableSMB_with_COB:!1,enableSMB_with_temptarget:!1,enableSMB_always:!1,enableSMB_after_carbs:!1,enableSMB_high_bg:!1,enableSMB_high_bg_target:110,allowSMB_with_high_temptarget:!1,maxSMBBasalMinutes:30,maxUAMSMBBasalMinutes:30,SMBInterval:3,bolus_increment:.1,maxDelta_bg_threshold:.2,curve:"rapid-acting",useCustomPeakTime:!1,insulinPeakTime:75,carbsReqThreshold:1,offline_hotspot:!1,noisyCGMTargetMultiplier:1.3,suspend_zeros_iob:!0,enableEnliteBgproxy:!1,calc_glucose_noise:!1,target_bg:!1,edison_battery_shutdown_voltage:3050,pi_battery_shutdown_percent:2,threshold_setting:65,smb_delivery_ratio:.5}}function u(e,t,a){var _=a&&a.type?a:{max_iob:0,max_daily_safety_multiplier:3,current_basal_safety_multiplier:4,autosens_max:1.2,autosens_min:.7,rewind_resets_autosens:!0,high_temptarget_raises_sensitivity:!1,low_temptarget_lowers_sensitivity:!1,sensitivity_raises_target:!0,resistance_lowers_target:!1,exercise_mode:!1,half_basal_exercise_target:160,maxCOB:120,skip_neutral_temps:!1,unsuspend_if_no_temp:!1,bolussnooze_dia_divisor:2,min_5m_carbimpact:8,autotune_isf_adjustmentFraction:1,remainingCarbsFraction:1,remainingCarbsCap:90,enableUAM:!0,A52_risk_enable:!1,enableSMB_with_COB:!1,enableSMB_with_temptarget:!1,enableSMB_always:!1,enableSMB_after_carbs:!1,enableSMB_high_bg:!1,enableSMB_high_bg_target:110,allowSMB_with_high_temptarget:!1,maxSMBBasalMinutes:30,maxUAMSMBBasalMinutes:30,SMBInterval:3,bolus_increment:.1,maxDelta_bg_threshold:.2,curve:"rapid-acting",useCustomPeakTime:!1,insulinPeakTime:75,carbsReqThreshold:1,offline_hotspot:!1,noisyCGMTargetMultiplier:1.3,suspend_zeros_iob:!0,enableEnliteBgproxy:!1,calc_glucose_noise:!1,target_bg:!1,edison_battery_shutdown_voltage:3050,pi_battery_shutdown_percent:2,threshold_setting:65,smb_delivery_ratio:.5};for(var l in _)t.hasOwnProperty(l)&&(_[l]=t[l]);var u=t.settings;if(!(t.settings.insulin_action_curve>1))return o(e,"DIA of",_.dia,"is not supported"),-1;if(_.dia=u.insulin_action_curve,t.model&&(_.model=t.model),_.skip_neutral_temps=t.skip_neutral_temps,_.current_basal=r.basalLookup(t.basals),_.basalprofile=t.basals,_.basalprofile.forEach((e=>{e.rate=+(Math.round(e.rate+"e+3")+"e-3")})),_.max_daily_basal=r.maxDailyBasal(t),_.max_basal=r.maxBasalLookup(t),0===_.current_basal)return o(e,"current_basal of",_.current_basal,"is not supported"),-1;if(0===_.max_daily_basal)return o(e,"max_daily_basal of",_.max_daily_basal,"is not supported"),-1;if(_.max_basal<.1)return o(e,"max_basal of",_.max_basal,"is not supported"),-1;var g=s.bgTargetsLookup(e,t,_);_.out_units=t.targets.user_preferred_units,_.min_bg=Math.round(g.min_bg),_.max_bg=Math.round(g.max_bg),_.bg_targets=t.targets,_.bg_targets.targets.forEach((e=>{e.high=Math.round(e.high),e.low=Math.round(e.low),e.min_bg=Math.round(e.min_bg),e.max_bg=Math.round(e.max_bg)})),delete _.bg_targets.raw,_.temptargetSet=g.temptargetSet;var b=null;return[_.sens,b]=i.isfLookup(t.isf,void 0,b),_.isfProfile=t.isf,_.sens<5?(o(e,"ISF of",_.sens,"is not supported"),-1):(void 0!==t.carbratio?(_.carb_ratio=n.carbRatioLookup(e,t,_),_.carb_ratios=t.carbratio):o(e,"Profile wasn't given carb ratio data, cannot calculate carb_ratio"),_)}u.defaults=l,u.displayedDefaults=function(e){var t={max_iob:0,max_daily_safety_multiplier:3,current_basal_safety_multiplier:4,autosens_max:1.2,autosens_min:.7,rewind_resets_autosens:!0,high_temptarget_raises_sensitivity:!1,low_temptarget_lowers_sensitivity:!1,sensitivity_raises_target:!0,resistance_lowers_target:!1,exercise_mode:!1,half_basal_exercise_target:160,maxCOB:120,skip_neutral_temps:!1,unsuspend_if_no_temp:!1,bolussnooze_dia_divisor:2,min_5m_carbimpact:8,autotune_isf_adjustmentFraction:1,remainingCarbsFraction:1,remainingCarbsCap:90,enableUAM:!0,A52_risk_enable:!1,enableSMB_with_COB:!1,enableSMB_with_temptarget:!1,enableSMB_always:!1,enableSMB_after_carbs:!1,enableSMB_high_bg:!1,enableSMB_high_bg_target:110,allowSMB_with_high_temptarget:!1,maxSMBBasalMinutes:30,maxUAMSMBBasalMinutes:30,SMBInterval:3,bolus_increment:.1,maxDelta_bg_threshold:.2,curve:"rapid-acting",useCustomPeakTime:!1,insulinPeakTime:75,carbsReqThreshold:1,offline_hotspot:!1,noisyCGMTargetMultiplier:1.3,suspend_zeros_iob:!0,enableEnliteBgproxy:!1,calc_glucose_noise:!1,target_bg:!1,edison_battery_shutdown_voltage:3050,pi_battery_shutdown_percent:2,threshold_setting:65,smb_delivery_ratio:.5},a={};return a.max_iob=t.max_iob,a.max_daily_safety_multiplier=t.max_daily_safety_multiplier,a.current_basal_safety_multiplier=t.current_basal_safety_multiplier,a.autosens_max=t.autosens_max,a.autosens_min=t.autosens_min,a.rewind_resets_autosens=t.rewind_resets_autosens,a.exercise_mode=t.exercise_mode,a.sensitivity_raises_target=t.sensitivity_raises_target,a.unsuspend_if_no_temp=t.unsuspend_if_no_temp,a.enableSMB_with_COB=t.enableSMB_with_COB,a.enableSMB_with_temptarget=t.enableSMB_with_temptarget,a.enableUAM=t.enableUAM,a.curve=t.curve,a.offline_hotspot=t.offline_hotspot,a.edison_battery_shutdown_voltage=t.edison_battery_shutdown_voltage,a.pi_battery_shutdown_percent=t.pi_battery_shutdown_percent,o(e,a),a},e.exports=u},497:(e,t)=>{function a(e,t,a){var r=t;void 0===t&&(r=new Date);var s=60*r.getHours()+r.getMinutes();if(a&&s>=a.offset&&s<a.endOffset)return[a.sensitivity,a];var i=(e=e.sensitivities.slice().sort(((e,t)=>e.offset-t.offset)))[e.length-1];if(0!==e[0].offset)return[-1,a];for(var n=1440,_=0;_<e.length-1;_++){var o=e[_],l=e[_+1];if(s>=o.offset&&s<l.offset){n=l.offset,i=e[_];break}}return(a=i).endOffset=n,[i.sensitivity,a]}a.isfLookup=a,e.exports=a},511:e=>{function t(e,t){e.length>0&&(e+="\n");for(var a=t.length,r=0;r<a;r++)"object"!=typeof t[r]?e+=t[r]:e+=JSON.stringify(t[r]),r!=a-1&&(e+=" ");return e}e.exports={console_log:function(e,...a){e.stdout=t(e.stdout,a)},console_error:function(e,...a){e.err=t(e.err,a)},process_exit:function(e,t){e.return_val=t},initFinalResults:function(){return{stdout:"",err:"",return_val:0}}}},590:(e,t,a)=>{var r=a(304),s=a(511).console_error;function i(e,t,a){return _(n(e,t,a))}function n(e,t,a){for(var i=t.targets,n=t.temptargets,_=new Date,o=i.targets[i.targets.length-1],l=0;l<i.targets.length-1;l++)if(_>=r(i.targets[l].offset)&&_<r(i.targets[l+1].offset)){o=i.targets[l];break}a.target_bg&&(o.low=a.target_bg),o.high=o.low;var u=o;try{n.sort((function(e,t){return new Date(t.created_at)-new Date(e.created_at)}))}catch(t){s(e,"No temptargets found.")}for(l=0;l<n.length;l++){var g=new Date(n[l].created_at),b=new Date(g.getTime()+60*n[l].duration*1e3);if(_>=g&&0===n[l].duration){u=o;break}if(!n[l].targetBottom||!n[l].targetTop){s(e,"eventualBG target range invalid: "+n[l].targetBottom+"-"+n[l].targetTop);break}if(_>=g&&_<b){u.high=n[l].targetTop,u.low=n[l].targetBottom,u.temptargetSet=!0;break}}return o=u}function _(e){return e.high<20&&(e.high=18*e.high),e.low<20&&(e.low=18*e.low),e.max_bg=Math.max(80,e.high),e.min_bg=Math.max(80,e.low),e.min_bg=Math.min(200,e.min_bg),e.max_bg=Math.min(200,e.max_bg),e}i.bgTargetsLookup=i,i.lookup=n,i.bound_target_range=_,e.exports=i}},t={};var a=function a(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,a),i.exports}(452);freeaps_profile=a})();